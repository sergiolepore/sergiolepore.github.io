<% 
var lang = config.language || false;

var html_classes = '';
if (page.permalink) html_classes = 'page-with-contents';

var title = [];
if (page.current > 1) title.push(__('page', page.current));
if (page.title) title.push(page.title);
if (page.category) title.push(page.category);
if (page.tag) title.push(page.tag);
if (page.archive){
  if (page.year) title.push(__('archive_b', page.year + (page.month ? '/' + page.month : '')));
  else title.push(__('archive_a'));
}
title.push(config.title);

var description = '';
if (page.description) {
  description = page.description;
} else if (page.excerpt) {
  description = strip_html(page.excerpt).replace(/^\s*/, '').replace(/\s*$/, '');
} else if (config.description) {
  description = strip_html(config.description).replace(/^\s*/, '').replace(/\s*$/, '');
} else if (page.content) {
  description = strip_html(page.content).replace(/^\s*/, '').replace(/\s*$/, '').substring(0, 150);
}

var socialMediaTitle = '';
if (page.title) {
  socialMediaTitle = page.title;
} else {
  socialMediaTitle = config.title;
}

var socialMediaImage = null;
var absoluteUrlRegExp = new RegExp('^(?:[a-z]+:)?//', 'i');
if (page.socialmedia_image) {
  if (absoluteUrlRegExp.test(page.socialmedia_image)) {
    socialMediaImage = page.socialmedia_image;
  } else {
    socialMediaImage = config.url + config.root + page.socialmedia_image;
  }
}

var rss_link = '';
if (theme.rss.url) {
  rss_link = theme.rss.url;
} else {
  rss_link = url_for('atom.xml');
}
%>
<!DOCTYPE HTML>
<html class="<%- html_classes %>" <% if (lang) { %>lang="<%- lang %>"<% } %>>
<head>
  <meta charset="utf-8">
  <title><%= title.join(' | ') %></title>
<% if (config.author){ %>
  <meta name="author" content="<%= config.author %>">
<% } %>
  <meta name="description" content="<%= description %>">
<% if (page.keywords){ %>
  <meta name="keywords" content="<%= page.keywords %>">
<% } %>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@sergiolepore" />
  <meta name="twitter:title" content="<%- socialMediaTitle %>" />
  <meta name="twitter:description" content="<%- description %>" />
  <meta name="twitter:creator" content="@sergiolepore">
<% if (socialMediaImage) { %>
  <meta name="twitter:image:src" content="<%- socialMediaImage %>" />
<% } %>
  <meta property="og:title" content="<%- socialMediaTitle %>" /> 
  <meta property="og:type" content="article" /> 
  <meta property="og:url" content="<%- url_for(page.permalink) %>" />
<% if (socialMediaImage) { %>
  <meta property="og:image" content="<%- socialMediaImage %>" />
<% } %>
  <meta property="og:description" content="<%- description %>" /> 
  <meta property="og:site_name" content="<%- config.title %>" /> 
  <link href="<%- config.root %>favicon.png" rel="icon">
  <link rel="alternate" href="<%- rss_link %>" title="<%- config.title %>" type="application/atom+xml">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="<%- config.root %>css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="<%- config.root %>css/vendor/powertip/jquery.powertip.min.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="<%- config.root %>js/jquery.powertip.min.js"></script>
  <script type="text/javascript" src="<%- config.root %>js/terminal.selecttext.js"></script>
<% if (config.cookiecuttr.enabled || theme.cookiecuttr.enabled) { %>
  <link rel="stylesheet" href="<%- config.root %>css/vendor/cookiecuttr.css">
  <script type="text/javascript" src="<%- config.root %>js/jquery.cookie.js"></script>
  <script type="text/javascript" src="<%- config.root %>js/jquery.cookiecuttr.js"></script>
  <script>
    $(document).ready(function () {
      $.cookieCuttr({
        cookieAnalyticsMessage: '<%- theme.cookiecuttr.text %>',
        cookieWhatAreTheyLink: '<%- theme.cookiecuttr.help_site %>',
        cookieDeclineButton: true,
        cookieResetButton: false,
        cookieDomain: 'www.sergiolepore.net',
        cookieAcceptButtonText: 'Aceptar Cookies',
        cookieDeclineButtonText: 'Rechazar Cookies',
        cookieResetButtonText: 'Restablecer Cookies',
        cookieWhatAreLinkText: '¿Qué significa esto?'
      });

      //reset cookies
      $('#no-cookies-disqus a.cc-cookie-reset, .privacy-policy a.cc-cookie-reset').click(function (e) {
        e.preventDefault();
        $.cookie("cc_cookie_accept", null, {
          path: '/'
        });
        $.cookie("cc_cookie_decline", null, {
          path: '/'
        });
        
        location.reload();
      });
    });
  </script>
<% } %>
  <%- partial('google_analytics', null, {cache:true}) %>
<% if (theme.gist_embed) { %>
  <%- partial('gist_embed', null, {cache:true}) %>
<% } %>
</head>